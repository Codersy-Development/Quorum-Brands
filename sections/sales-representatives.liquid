{% comment %}sections/sales-representatives-csv.liquid{% endcomment %}

<div class="page-width">
  <div class="sales-reps-header text-center margin-bottom-3">
    <h1>{{ section.settings.title }}</h1>
    <div class="rte">{{ section.settings.description }}</div>
  </div>

  <div class="search-filters margin-bottom-3">
    <div class="search-container">
      <input 
        type="text" 
        id="repSearch" 
        class="search-input" 
        placeholder="Search by name or group..."
      >
      <select id="territoryFilter" class="territory-select">
        <option value="">All Territories</option>
      </select>
    </div>
  </div>

  <!-- Results count -->
  <div class="results-info margin-bottom-2">
    <p id="resultsCount"></p>
  </div>

  <!-- Loading indicator -->
  <div id="loadingIndicator" class="loading">
    <p>Loading representatives...</p>
  </div>

  <!-- Dynamic rep cards will be inserted here -->
  <div class="sales-reps-grid" id="repsContainer"></div>

  <div id="noResults" class="no-results" style="display: none;">
    <p>No sales representatives found matching your search criteria.</p>
  </div>

  <!-- Pagination Controls -->
  <div class="pagination" id="paginationContainer" style="display: none;">
    <span class="prev" id="prevPage" style="display: none;">
      <a href="#" title="Previous">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-chevron-left" viewBox="0 0 284.49 498.98">
          <title>icon-chevron</title>
          <path d="M249.49 0a35 35 0 0 1 24.75 59.75L84.5 249.49l189.74 189.74a35.002 35.002 0 0 1-49.5 49.5L10.25 274.24a35 35 0 0 1 0-49.5L224.74 10.25A34.89 34.89 0 0 1 249.49 0Z"></path>
        </svg>
        <span class="icon__fallback-text">Previous</span>
      </a>
    </span>
    
    <div id="pageNumbers"></div>
    
    <span class="next" id="nextPage" style="display: none;">
      <a href="#" title="Next">
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-chevron-right" viewBox="0 0 284.49 498.98">
          <title>icon-chevron</title>
          <path d="M35 498.98a35 35 0 0 1-24.75-59.75l189.74-189.74L10.25 59.75a35.002 35.002 0 0 1 49.5-49.5l214.49 214.49a35 35 0 0 1 0 49.5L59.75 488.73A34.89 34.89 0 0 1 35 498.98Z"></path>
        </svg>
        <span class="icon__fallback-text">Next</span>
      </a>
    </span>
  </div>
</div>

<style>
  .search-filters {
    margin-bottom: 30px;
  }

  .search-container {
    display: flex;
    gap: 15px;
    max-width: 800px;
    margin: 0 auto;
  }

  .search-input {
    flex: 1;
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
  }

  .territory-select {
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    min-width: 200px;
  }

  .results-info {
    text-align: center;
    margin-bottom: 20px;
  }

  .results-info p {
    color: #666;
    font-size: 14px;
  }

  .loading {
    text-align: center;
    padding: 40px;
    color: #666;
  }

  .sales-rep-card {
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  .sales-rep-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .sales-rep-card h3 {
    margin: 0 0 10px 0;
  }
  
  .rep-group {
    color: #666;
    font-style: italic;
    margin-bottom: 10px;
  }
  
  .rep-details {
    margin-top: 15px;
  }
  
  .rep-details p {
    margin: 5px 0;
  }

  .email a {
    text-decoration: none;
  }

  .email a:hover {
    text-decoration: underline;
  }

  .email, .phone, .cell-phone, .website {
    margin: 5px 0;
  }

  .website a {
    color: #0066cc;
    text-decoration: none;
  }

  .website a:hover {
    text-decoration: underline;
  }

  .phone, .cell-phone {
    font-family: monospace;
  }
  
  .territory {
    position: relative;
    padding: 15px 0;
    margin: 15px 0 !important;
    border-top: 1px solid #998542;
    border-bottom: 1px solid #998542;
  }

  .territory-detail {
    display: block;
    font-style: italic;
    color: #666;
    font-size: 0.8em;
    margin-top: 5px;
  }

  .no-results {
    text-align: center;
    padding: 40px;
    font-size: 18px;
    color: #666;
  }

  /* Pagination Styles */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 40px;
    flex-wrap: wrap;
  }

  .pagination .page {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 4px;
    background: none;
    border: none;
    font-size: 16px;
    line-height: 40px;
    height: 40px;
  }

  .pagination .page a {
    color: #121212;
    text-decoration: none;
    font-weight: normal;
    transition: opacity 0.3s ease;
    line-height: 1;
  }

  .pagination .page a:hover {
    opacity: 0.7;
  }

  .pagination .page.current {
    color: #999999;
    font-weight: normal;
    line-height: 1;
  }

  .pagination .prev,
  .pagination .next {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background-color: #121212;
    border: none;
    cursor: pointer;
    transition: opacity 0.3s ease;
    flex-shrink: 0;
  }

  .pagination .prev:hover,
  .pagination .next:hover {
    opacity: 0.8;
  }

  .pagination .prev a,
  .pagination .next a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: #ffffff;
    text-decoration: none;
  }

  .pagination .icon {
    width: 16px;
    height: 16px;
    fill: currentColor;
  }

  .pagination .icon__fallback-text {
    display: none;
  }
  
  @media screen and (min-width: 750px) {
    .sales-reps-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
  }
  
  @media screen and (min-width: 990px) {
    .sales-reps-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media screen and (max-width: 749px) {
    .search-container {
      flex-direction: column;
    }
    
    .territory-select {
      width: 100%;
    }

    .pagination {
      gap: 15px;
    }

    .pagination .page {
      height: 36px;
      line-height: 36px;
    }

    .pagination .prev,
    .pagination .next {
      width: 36px;
      height: 36px;
    }

    .pagination .icon {
      width: 14px;
      height: 14px;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const repSearch = document.getElementById('repSearch');
  const territoryFilter = document.getElementById('territoryFilter');
  const repsContainer = document.getElementById('repsContainer');
  const noResults = document.getElementById('noResults');
  const loadingIndicator = document.getElementById('loadingIndicator');
  const paginationContainer = document.getElementById('paginationContainer');
  const pageNumbers = document.getElementById('pageNumbers');
  const prevPage = document.getElementById('prevPage');
  const nextPage = document.getElementById('nextPage');
  const resultsCount = document.getElementById('resultsCount');
  
  const ITEMS_PER_PAGE = {{ section.settings.items_per_page | default: 25 }};
  let currentPage = 1;
  let filteredReps = [];
  let allReps = [];

  // CSV data - Replace this with your actual rep data
  const csvData = `name,rep-group,position,territory,territory_details,email,phone,cell_phone,website
Quorum,Quorum Showroom,Showroom,024-Q,USA,fbradford@quorumintl.com,817-682-6323,,
Adam,Adam Barri,Barri,1164-Q,USA,303lighting@gmail.com,(720) 984-5442,,
HCL,HCL High Country Lighting,High Country Lighting,1167-Q,USA,Kurt@highcountrylighting.com, (406) 599-5884,,
Rich,Rich Andrews,Andrews,123,USA,randrews@imcdi.com,5613137702,5613137702,
Scott,Scott Rosenberg,Rosenberg,14-Q,USA,scottrosenberg@pnwrs.com,541-914-8086,,
Sarah,Sarah Yeganhe,Yeganhe,14-Q,USA,sarahyeganhe@gmail.com,714-351-3810,,
Sebastian,Sebastian Castrillon,Castrillon,22-Q,USA,sebastian@lightingreps.net,786-306-0865,,
Alejandro,Alejandro Franco,Franco,22-Q,USA,alejandro@lightingreps.net,7864889721,,
CARLOS,CARLOS LEON,LEON,22-Q,USA,carlos@lightingreps.net,7877081532,,
Joe,Joe Ortiz,Ortiz,23-Q,USA,joe@ortizlightingsales.com,407-556-4644,,
Bill,Bill Lincoln,Lincoln,24-Q,USA,WLincolnTLG@gmail.com,(229)881-0530,(229)881-0530,
Todd,Todd Tracy,Tracy,24-Q,USA,ttracy1@bellsouth.net,404-402-8320,,
John,John Patsey,Patsey,25-Q,USA,ed@jpsinc.net,859-621-3322,,
Benezech-Striklin,Benezech-Striklin Sales Team,Sales Team,28-Q,USA,office@bassales.net,2258929520,,
Benezech,Benezech Stricklin,Stricklin,28-Q,USA,hstricklin@yahoo.com,985-893-1860,,
Benezech,Benezech Stricklin,Stricklin,28-Q,USA,ebenezech@yahoo.com,985-893-1860,,
Mark,Mark Vinson,Vinson,30-Q,USA,mark@luminalightingsales.com,8034098211,8034098211,
Roberta,Roberta Misicka,Misicka,31-Q,USA,misicka@me.com,312-217-3115,,
Aaron,Aaron Ward,Ward,32-Q,USA,award7@horizonlightingsales.com,512-736-9434,,
Shelby,Shelby Meister,Meister,33-Q,USA,meistershelby@gmail.com,314-878-5166,,
Dan,Dan Adelberger,Adelberger,34-Q,USA,dan@adelbergerassociates.com,12152628810,,
Metrolight,Metrolight Sales Corp,Sales Corp,35-Q,USA,rachel@metrolightsales.com,973-912-9565,,
Barry,Barry Troy,Troy,35-Q,USA,barrytroy@mac.com,908-419-8775,,
Katie,Katie Katona,Katona,37-Q,USA,katie.katona@gmail.com,6144046788,6144046788,
Gilda,Gilda Rabinovitz,Rabinovitz,39-Q,USA,gildarabi@gmail.com,(577)090-1135,,
Alejandro,Alejandro Rabinovitz,Rabinovitz,39-Q,USA,alejandro@multimueble.com.mx,(577)090-1135,,
Kirk,Kirk Martin,Martin,40-Q,USA,Kirk@ZayaMartin.com,508-292-6771,,
Chris,Chris Zaya,Zaya,40-Q,USA,Chris@zayamartin.com,6177500677,,
Mishir,Mishir Fernandez,Fernandez,47-Q,USA,mishir@lightingreps.net,787-586-1903,,
Nancy,Nancy Jensen,Jensen,50-Q,USA,Nancy@JensenLtg.com,612-209-3827,612-209-3827,
Dave/Nancy,Dave/Nancy Jensen,Jensen,50-Q,USA,info@jensenlighting.com,952-996-9466,,
Mike,Mike Jensen,Jensen,50-Q,USA,Mike@jensenLighting.com,952-292-9213,,
Bret,Bret Devine,Devine,63-Q,USA,devinesales@aol.com,8167288222,8167288222,
Dulanski,Dulanski Group,Group,708-Q,USA,lighting@dulanski.com,914-328-5557,,
Quantum,Quantum Lighting Group,Lighting Group,758-Q,USA,sstraw@quantumltg.com,801-270-0010  ,,
Creighton,Creighton Bostrom,Bostrom,79-Q,USA,Creighton@Southernglowsales.com,9196040412,,
Rebecca,Rebecca Cunningham,Cunningham,79-Q,USA,Rebecca@southernglowsales.com,5704048699,,
Dan,Dan Donavan,Donavan,79-Q,USA,dandon@comcast.net,0000000000,,
Carrie,Carrie Gonzales,Gonzales,79-Q,USA,carrie@southernglowsales.com,803-409-8211,,
Rachel,Rachel Lynch,Lynch,79-Q,USA,rachel@southernglowsales.com,6034910510,,
Jeff,Jeff Norris,Norris,79-Q,USA,jeff@southernglowsales.com,9193493700,,
Mark,Mark Vinson,Vinson,79-Q,USA,mark@southernglowsales.com,803-409-8211,,
Stephen,Stephen Katona,Katona,80-Q,USA,stephenkatona@gmail.com,8476443176,8476443176,
Karli,Karli Khan,Khan,830-Q,USA,sales@jlwlighting.com,8598150004,,
Jackie,Jackie Doug,Doug,833-Q,USA,dbaa@telus.net,6049706598,,
Patrick,Patrick Marineau,Marineau,99-Q,USA,Patrick@Lesventespm.com,514-206-4684,,
Dan,Dan McIntosh,McIntosh,99-Q,USA,daan@norlite.sa,416-567-5661,,
House,House Account,Account,House,USA,customersupport@quorumintl.com,555-555-5555,,
Halle,Halle Nealy,Nealy,House,USA,hnealy@quorumintl.com,1111111111,,
Halle,Halle Nealy,Nealy,House,USA,hnealy.cyan@gmail.com,9728492583,,
House,House Rep,Rep,House,USA,jalopez@quorumintl.com,8172010157,,
Rich,Rich Andrews,Andrews,REPZIO,USA,randrews@junipercommerce.com,9542572988,9542572988,
Michael,Michael Clemmer,Clemmer,REPZIO,USA,phil@repzio.com,4107704901,,
Adam,Adam Clinard,Clinard,REPZIO,USA,aclinard@andmore.com,336-703-8720,,
Mackenzie,Mackenzie Harris,Harris,REPZIO,USA,maharris@imcdi.com,1234567890,,
Jacki,Jacki Huelsenbeck,Huelsenbeck,REPZIO,USA,bivauveddeussi-1865@yopmail.com,319-213-0070,,
Melissa,Melissa jara,jara,REPZIO,USA,mjara@andmore.com,123,,
Bill,Bill Summa,Summa,REPZIO,USA,bill@repzio.com,8554387379,9144695330,
Ben,Ben Wineland,Wineland,REPZIO,USA,bwineland@junipercommerce.com,6157053708,,
Scott,Scott Beane,Beane,SB-test,USA,sbeane@andmore.com,7029311737,,
Dimitrius,Dimitrius Samudio,Samudio,Test2-Q,USA,dsamudio@quorumintl.com,1111111111,,
;
  function parseCSV(csv) {
    const lines = csv.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
    
    return lines.slice(1).map(line => {
      const values = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
      const rep = {};
      
      headers.forEach((header, index) => {
        rep[header] = values[index] ? values[index].replace(/"/g, '').trim() : '';
      });
      
      return rep;
    });
  }

  function createRepCard(rep) {
    const territories = rep.territory ? rep.territory.split(',').map(t => t.trim()) : [];
    
    return `
      <div class="sales-rep-card" 
           data-territories="${territories.join(',')}"
           data-name="${rep.name}"
           data-group="${rep.rep_group}">
        <h3>${rep.name}</h3>
        ${rep.rep_group ? `<p class="rep-group">${rep.rep_group}</p>` : ''}
        <div class="rep-details">
          ${rep.position ? `<p class="position">${rep.position}</p>` : ''}
          ${rep.territory ? `
            <p class="territory">
              Territory: ${rep.territory}
              ${rep.territory_detail ? `<span class="territory-detail">${rep.territory_detail}</span>` : ''}
            </p>
          ` : ''}
          ${rep.email ? `<p class="email"><a href="mailto:${rep.email}">${rep.email}</a></p>` : ''}
          ${rep.phone ? `<p class="phone"><strong>Phone:</strong> ${rep.phone}</p>` : ''}
          ${rep.cell_phone ? `<p class="cell-phone"><strong>Cell:</strong> ${rep.cell_phone}</p>` : ''}
          ${rep.website ? `<p class="website"><a href="${rep.website}" target="_blank" rel="noopener">${rep.website.replace(/https?:\/\//, '').replace(/www\./, '')}</a></p>` : ''}
        </div>
      </div>
    `;
  }

  function populateTerritoryFilter() {
    const territories = new Set();
    allReps.forEach(rep => {
      if (rep.territory) {
        rep.territory.split(',').forEach(t => {
          const territory = t.trim();
          if (territory) territories.add(territory);
        });
      }
    });
    
    const sortedTerritories = Array.from(territories).sort();
    territoryFilter.innerHTML = '<option value="">All Territories</option>';
    sortedTerritories.forEach(territory => {
      territoryFilter.innerHTML += `<option value="${territory}">${territory}</option>`;
    });
  }

  function getFilteredReps() {
    const searchTerm = repSearch.value.toLowerCase();
    const selectedTerritory = territoryFilter.value.toLowerCase();
    
    return allReps.filter(rep => {
      const territories = rep.territory ? rep.territory.toLowerCase().split(',').map(t => t.trim()) : [];
      const name = rep.name.toLowerCase();
      const group = rep.rep_group.toLowerCase();
      
      const matchesSearch = name.includes(searchTerm) || group.includes(searchTerm);
      const matchesTerritory = selectedTerritory === '' || territories.some(t => t.includes(selectedTerritory));

      return matchesSearch && matchesTerritory;
    });
  }

  function updateResultsCount() {
    const totalResults = filteredReps.length;
    const startItem = totalResults > 0 ? (currentPage - 1) * ITEMS_PER_PAGE + 1 : 0;
    const endItem = Math.min(currentPage * ITEMS_PER_PAGE, totalResults);
    
    if (totalResults === 0) {
      resultsCount.textContent = 'No representatives found';
    } else if (totalResults <= ITEMS_PER_PAGE) {
      resultsCount.textContent = `Showing all ${totalResults} representatives`;
    } else {
      resultsCount.textContent = `Showing ${startItem}-${endItem} of ${totalResults} representatives`;
    }
  }

  function displayPage() {
    if (filteredReps.length === 0) {
      repsContainer.innerHTML = '';
      noResults.style.display = 'block';
      paginationContainer.style.display = 'none';
      updateResultsCount();
      return;
    }

    noResults.style.display = 'none';
    
    const totalPages = Math.ceil(filteredReps.length / ITEMS_PER_PAGE);
    paginationContainer.style.display = totalPages > 1 ? 'flex' : 'none';

    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
    const endIndex = startIndex + ITEMS_PER_PAGE;
    const pageReps = filteredReps.slice(startIndex, endIndex);

    repsContainer.innerHTML = pageReps.map(rep => createRepCard(rep)).join('');

    updateResultsCount();
    updatePaginationControls();
  }

  function updatePaginationControls() {
    const totalPages = Math.ceil(filteredReps.length / ITEMS_PER_PAGE);
    
    if (currentPage === 1) {
      prevPage.style.display = 'none';
    } else {
      prevPage.style.display = 'inline-flex';
    }
    
    if (currentPage === totalPages || totalPages === 0) {
      nextPage.style.display = 'none';
    } else {
      nextPage.style.display = 'inline-flex';
    }

    pageNumbers.innerHTML = '';

    if (totalPages <= 1) return;

    const maxVisiblePages = 7;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

    if (endPage - startPage < maxVisiblePages - 1) {
      startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }

    if (startPage > 1) {
      addPageNumber(1);
      if (startPage > 2) addEllipsis();
    }

    for (let i = startPage; i <= endPage; i++) {
      addPageNumber(i);
    }

    if (endPage < totalPages) {
      if (endPage < totalPages - 1) addEllipsis();
      addPageNumber(totalPages);
    }
  }

  function addPageNumber(pageNum) {
    const pageSpan = document.createElement('span');
    pageSpan.className = 'page';
    
    if (pageNum === currentPage) {
      pageSpan.classList.add('current');
      pageSpan.textContent = pageNum;
    } else {
      const pageLink = document.createElement('a');
      pageLink.href = '#';
      pageLink.textContent = pageNum;
      pageLink.addEventListener('click', (e) => {
        e.preventDefault();
        goToPage(pageNum);
      });
      pageSpan.appendChild(pageLink);
    }
    
    pageNumbers.appendChild(pageSpan);
  }

  function addEllipsis() {
    const ellipsis = document.createElement('span');
    ellipsis.className = 'page';
    ellipsis.textContent = '…';
    pageNumbers.appendChild(ellipsis);
  }

  function goToPage(pageNum) {
    currentPage = pageNum;
    displayPage();
    repsContainer.scrollIntoView({ behavior: 'smooth' });
  }

  function filterAndPaginate() {
    filteredReps = getFilteredReps();
    currentPage = 1;
    displayPage();
  }

  // Initialize
  function init() {
    allReps = parseCSV(csvData);
    populateTerritoryFilter();
    filterAndPaginate();
    loadingIndicator.style.display = 'none';
  }

  // Event listeners
  repSearch.addEventListener('input', filterAndPaginate);
  territoryFilter.addEventListener('change', filterAndPaginate);

  prevPage.addEventListener('click', (e) => {
    e.preventDefault();
    if (currentPage > 1) goToPage(currentPage - 1);
  });

  nextPage.addEventListener('click', (e) => {
    e.preventDefault();
    const totalPages = Math.ceil(filteredReps.length / ITEMS_PER_PAGE);
    if (currentPage < totalPages) goToPage(currentPage + 1);
  });

  init();
});
</script>

{% schema %}
{
  "name": "Sales Rep CSV",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Sales Representatives"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Contact our professional sales team for assistance</p>"
    },
    {
      "type": "number",
      "id": "items_per_page",
      "label": "Representatives per page",
      "default": 25,
      "info": "Number of representatives to show per page"
    }
  ],
  "presets": [
    {
      "name": "Sales Representatives (CSV)"
    }
  ]
}
{% endschema %}